import os
import subprocess
import logging
from scapy.all import sniff, IP, TCP

# Set up logging for unauthorized access
logging.basicConfig(filename='honeypot.log',
                    format='%(asctime)s [UNAUTHORIZED] %(message)s',
                    level=logging.INFO)

# Configuration
SSH_PORT = 22
BLOCKED_IP = "192.168.50.100"  # Only this IP is blocked

def start_firewall():
    os.system("sudo iptables -F")  # Flush existing rules
    os.system(f"sudo iptables -A INPUT -p tcp --dport {SSH_PORT} -s {BLOCKED_IP} -j DROP")
    print(f"[+] Firewall started: Blocking SSH access from {BLOCKED_IP}")

def stop_firewall():
    os.system("sudo iptables -F")
    print("[*] Firewall stopped.")

def log_packet(pkt):
    if IP in pkt and TCP in pkt:
        src_ip = pkt[IP].src
        dst_port = pkt[TCP].dport
        if dst_port == SSH_PORT:
            print(f"[ACCESS] {src_ip} --> port {dst_port}")
            if src_ip == BLOCKED_IP:
                logging.info(f"{src_ip} attempted SSH access and was blocked")

def main():
    try:
        start_firewall()
        print("[*] Monitoring SSH traffic...")
        sniff(filter=f"tcp port {SSH_PORT}", prn=log_packet, store=0)
    except KeyboardInterrupt:
        stop_firewall()
        print("[*] Exiting...")

if _name_ == "_main_":
    main()
