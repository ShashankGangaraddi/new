#!/usr/sbin/nft -f

flush ruleset

table inet filter {
  chain forward {
    type filter hook forward priority 0;

    # Accept established/related connections
    ct state established,related accept

    # Allow only selected traffic from VM2 (192.168.50.100)
    ip saddr 192.168.50.100 ip protocol icmp accept         # Allow ICMP (ping)
    ip saddr 192.168.50.100 udp dport 53 accept             # Allow DNS queries (UDP)
    ip saddr 192.168.50.100 tcp dport 80 accept             # Allow HTTP

    # Log and drop everything else from VM2
    ip saddr 192.168.50.100 log prefix "Blocked: " flags all level warning
    ip saddr 192.168.50.100 drop

    # Allow everything else not from VM2 (optional)
    accept
  }
}

table ip nat {
  chain postrouting {
    type nat hook postrouting priority 100;
    oifname "enp0s3" masquerade
  }
}
