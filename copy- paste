import socket
import threading

LISTEN_IP = '0.0.0.0'
LISTEN_PORT = 8080
BLOCKED_IP = '192.168.50.100'  # IP to block

def handle_client(client_sock, client_addr):
    src_ip = client_addr[0]
    if src_ip == BLOCKED_IP:
        print(f"NOT ALLOWED connection from {src_ip}: client is explicitly denied")
        client_sock.close()
        return
    else:
        print(f"ALLOWED connection from {src_ip}: connection permitted")

    try:
        while True:
            data = client_sock.recv(1024)
            if not data:
                break
            # Optionally, echo or process data here
    except Exception as e:
        print(f"Connection error: {e}")
    finally:
        client_sock.close()

def start_firewall():
    server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    server.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
    server.bind((LISTEN_IP, LISTEN_PORT))
    server.listen(10)
    print(f"Firewall server listening on {LISTEN_IP}:{LISTEN_PORT}")

    while True:
        client_sock, client_addr = server.accept()
        threading.Thread(target=handle_client, args=(client_sock, client_addr), daemon=True).start()

if __name__ == '__main__':
    start_firewall()
