#!/usr/sbin/nft -f

table inet firewall {
    chain input {
        type filter hook input priority 0; policy drop;

        iif "lo" accept
        ct state established,related accept
    }

    chain forward {
        type filter hook forward priority 0; policy drop;

        # Allow ICMP (ping) from VM2 to internet
        ip saddr 192.168.50.100 ip daddr != 192.168.50.0/24 icmp accept

        # Allow HTTP (port 80) from VM2
        ip saddr 192.168.50.100 ip daddr != 192.168.50.0/24 tcp dport 80 accept

        # Allow HTTPS (port 443) from VM2
        ip saddr 192.168.50.100 ip daddr != 192.168.50.0/24 tcp dport 443 accept

        # Allow DNS (UDP 53) from VM2
        ip saddr 192.168.50.100 ip daddr != 192.168.50.0/24 udp dport 53 accept

        # Log and drop everything else from VM2
        ip saddr 192.168.50.100 log prefix "ðŸ”¥ BLOCKED: " flags all counter drop

        # Allow other forwarding if needed (e.g., for responses to VM2)
        ct state established,related accept
    }
}
