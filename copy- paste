#!/usr/sbin/nft -f

flush ruleset

table inet myfirewall {
  chain input {
    type filter hook input priority 0;
    policy accept;
  }

  chain forward {
    type filter hook forward priority 0;
    policy drop;

    # Allow ESTABLISHED and RELATED traffic
    ct state established, related accept

    # Allow DNS from VM2 (TCP and UDP port 53)
    ip saddr 192.168.50.100 udp dport 53 accept
    ip saddr 192.168.50.100 tcp dport 53 accept

    # Allow HTTP from VM2 (port 80)
    ip saddr 192.168.50.100 tcp dport 80 accept

    # Log and drop other traffic from VM2
    ip saddr 192.168.50.100 log prefix "DROP_VM2: " flags all drop

    # Allow other internal forwarding
    accept
  }

  chain output {
    type filter hook output priority 0;
    policy accept;
  }
}
